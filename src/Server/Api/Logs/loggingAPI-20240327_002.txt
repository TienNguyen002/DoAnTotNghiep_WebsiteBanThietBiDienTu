2024-03-27 16:44:21.395 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2024-03-27 16:44:21.440 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2024-03-27 16:44:21.554 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.583 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.586 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.588 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.590 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.591 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.592 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.593 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.594 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.596 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.597 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.598 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.606 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Colors] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.608 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Colors] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.609 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Colors] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.610 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Colors] AS [c]
        WHERE [c].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.615 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Statuses] AS [s]
        WHERE [s].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.617 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Statuses] AS [s]
        WHERE [s].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.618 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Statuses] AS [s]
        WHERE [s].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.619 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Statuses] AS [s]
        WHERE [s].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.623 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Roles] AS [r]
        WHERE [r].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.625 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Roles] AS [r]
        WHERE [r].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.629 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Tags] AS [t]
        WHERE [t].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.634 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Branches] AS [b]
        WHERE [b].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.635 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Branches] AS [b]
        WHERE [b].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.639 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.641 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.642 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.644 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.645 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.650 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]
        WHERE [p].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.651 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]
        WHERE [p].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.652 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__item_UrlSlug_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Products] AS [p]
        WHERE [p].[UrlSlug] = @__item_UrlSlug_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2024-03-27 16:44:21.830 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Branches] ([Name], [UrlSlug])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
INSERT INTO [Categories] ([Name], [UrlSlug])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3);
MERGE [Colors] USING (
VALUES (@p4, @p5, 0),
(@p6, @p7, 1),
(@p8, @p9, 2),
(@p10, @p11, 3)) AS i ([Name], [UrlSlug], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Name], [UrlSlug])
VALUES (i.[Name], i.[UrlSlug])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Tags] ([Name], [UrlSlug])
OUTPUT INSERTED.[Id]
VALUES (@p12, @p13);
2024-03-27 16:44:21.846 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p14='?' (DbType = Int32), @p15='?' (DbType = Int32), @p16='?' (DbType = Int32), @p17='?' (Size = 4000), @p18='?' (Size = 1000), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (DbType = Int32), @p22='?' (DbType = Int32), @p23='?' (Size = 4000), @p24='?' (DbType = Int32), @p25='?' (Size = 4000), @p26='?' (DbType = Int32), @p27='?' (DbType = Int32), @p28='?' (DbType = Int32), @p29='?' (Size = 4000), @p30='?' (Size = 1000), @p31='?' (Size = 4000), @p32='?' (DbType = Int32), @p33='?' (DbType = Int32), @p34='?' (DbType = Int32), @p35='?' (Size = 4000), @p36='?' (DbType = Int32), @p37='?' (Size = 4000), @p38='?' (DbType = Int32), @p39='?' (DbType = Int32), @p40='?' (DbType = Int32), @p41='?' (Size = 4000), @p42='?' (Size = 1000), @p43='?' (Size = 4000), @p44='?' (DbType = Int32), @p45='?' (DbType = Int32), @p46='?' (DbType = Int32), @p47='?' (Size = 4000), @p48='?' (DbType = Int32), @p49='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Products] USING (
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, 0),
(@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, 1),
(@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, 2)) AS i ([Amount], [BranchId], [CategoryId], [Description], [ImageUrl], [Name], [OrPrice], [OrderId], [Price], [Specification], [TagId], [UrlSlug], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [BranchId], [CategoryId], [Description], [ImageUrl], [Name], [OrPrice], [OrderId], [Price], [Specification], [TagId], [UrlSlug])
VALUES (i.[Amount], i.[BranchId], i.[CategoryId], i.[Description], i.[ImageUrl], i.[Name], i.[OrPrice], i.[OrderId], i.[Price], i.[Specification], i.[TagId], i.[UrlSlug])
OUTPUT INSERTED.[Id], INSERTED.[Status], i._Position;
2024-03-27 16:44:21.861 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'Infrastructure.Contexts.DeviceWebDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Orders_Products". The conflict occurred in database "DeviceWeb", table "dbo.Orders", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Storage.RelationalDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
ClientConnectionId:c2a62fb5-adb6-4ff6-a87b-a44d7778539f
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Orders_Products". The conflict occurred in database "DeviceWeb", table "dbo.Orders", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Storage.RelationalDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
ClientConnectionId:c2a62fb5-adb6-4ff6-a87b-a44d7778539f
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2024-03-27 16:44:21.881 +07:00 [ERR] Could not insert data into database
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Orders_Products". The conflict occurred in database "DeviceWeb", table "dbo.Orders", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Storage.RelationalDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
ClientConnectionId:c2a62fb5-adb6-4ff6-a87b-a44d7778539f
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges()
   at Infrastructure.Seeders.DataSeeder.AddProducts(IList`1 categories, IList`1 branches, IList`1 colors, IList`1 tags) in D:\Year4-Term2\DATN\DoAnTotNghiep_WebsiteBanThietBiDienTu\src\Server\Infrastructure\Seeder\DataSeeder.cs:line 278
   at Infrastructure.Seeders.DataSeeder.Initialize() in D:\Year4-Term2\DATN\DoAnTotNghiep_WebsiteBanThietBiDienTu\src\Server\Infrastructure\Seeder\DataSeeder.cs:line 30
   at Api.Extensions.WebApplicationExtensions.UseDataSeeder(IApplicationBuilder app) in D:\Year4-Term2\DATN\DoAnTotNghiep_WebsiteBanThietBiDienTu\src\Server\Api\Extensions\WebApplicationExtensions.cs:line 98
2024-03-27 16:44:21.910 +07:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2024-03-27 16:44:21.971 +07:00 [INF] Now listening on: https://localhost:7249
2024-03-27 16:44:21.971 +07:00 [INF] Now listening on: http://localhost:5002
2024-03-27 16:44:21.987 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-27 16:44:21.988 +07:00 [INF] Hosting environment: Development
2024-03-27 16:44:21.989 +07:00 [INF] Content root path: D:\Year4-Term2\DATN\DoAnTotNghiep_WebsiteBanThietBiDienTu\src\Server\Api
2024-03-27 16:44:41.914 +07:00 [INF] Executed DbCommand (147ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [DeviceWeb];
2024-03-27 16:44:41.970 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [DeviceWeb] SET READ_COMMITTED_SNAPSHOT ON;
END;
2024-03-27 16:44:41.981 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2024-03-27 16:44:42.016 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [__EFMigrationsHistory] (
    [MigrationId] nvarchar(150) NOT NULL,
    [ProductVersion] nvarchar(32) NOT NULL,
    CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
);
2024-03-27 16:44:42.017 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2024-03-27 16:44:42.025 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2024-03-27 16:44:42.028 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2024-03-27 16:44:42.036 +07:00 [INF] Applying migration '20240327094413_InitialCreate'.
2024-03-27 16:44:42.070 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Branches] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Branches] PRIMARY KEY ([Id])
);
2024-03-27 16:44:42.071 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Categories] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Categories] PRIMARY KEY ([Id])
);
2024-03-27 16:44:42.818 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Colors] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Colors] PRIMARY KEY ([Id])
);
2024-03-27 16:44:42.819 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Roles] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Roles] PRIMARY KEY ([Id])
);
2024-03-27 16:44:42.820 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Statuses] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Statuses] PRIMARY KEY ([Id])
);
2024-03-27 16:44:42.821 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Tags] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Tags] PRIMARY KEY ([Id])
);
2024-03-27 16:44:45.424 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [Phone] nvarchar(max) NOT NULL,
    [Password] nvarchar(16) NOT NULL,
    [Address] nvarchar(max) NOT NULL,
    [RoleId] int NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Roles_Users] FOREIGN KEY ([RoleId]) REFERENCES [Roles] ([Id]) ON DELETE CASCADE
);
2024-03-27 16:44:45.425 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Orders] (
    [Id] int NOT NULL IDENTITY,
    [DateOrder] datetime NOT NULL,
    [Quantity] int NOT NULL,
    [TotalPrice] int NOT NULL,
    [StatusId] int NOT NULL,
    [UserId] int NOT NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Statuses_Orders] FOREIGN KEY ([StatusId]) REFERENCES [Statuses] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Users_Orders] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);
2024-03-27 16:44:48.599 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [UrlSlug] nvarchar(max) NOT NULL,
    [ImageUrl] nvarchar(1000) NULL,
    [Description] nvarchar(max) NOT NULL,
    [Specification] nvarchar(max) NOT NULL,
    [Amount] int NOT NULL,
    [Status] bit NOT NULL DEFAULT CAST(1 AS bit),
    [Price] int NULL,
    [OrPrice] int NOT NULL,
    [CategoryId] int NOT NULL,
    [BranchId] int NOT NULL,
    [TagId] int NOT NULL,
    [OrderId] int NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Branches_Products] FOREIGN KEY ([BranchId]) REFERENCES [Branches] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Categories_Products] FOREIGN KEY ([CategoryId]) REFERENCES [Categories] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Orders_Products] FOREIGN KEY ([OrderId]) REFERENCES [Orders] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Tags_Products] FOREIGN KEY ([TagId]) REFERENCES [Tags] ([Id]) ON DELETE CASCADE
);
2024-03-27 16:44:48.600 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Comments] (
    [Id] int NOT NULL IDENTITY,
    [Detail] nvarchar(max) NOT NULL,
    [CommentDate] datetime NOT NULL,
    [ProductId] int NOT NULL,
    [UserId] int NOT NULL,
    CONSTRAINT [PK_Comments] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Comments_Products] FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Comments_Users] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2024-03-27 16:44:51.751 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Images] (
    [Id] int NOT NULL IDENTITY,
    [ImageUrl] nvarchar(1000) NOT NULL,
    [ProductId] int NOT NULL,
    CONSTRAINT [PK_Images] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Images_Products] FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE
);
2024-03-27 16:44:51.752 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [ProductColors] (
    [ColorsId] int NOT NULL,
    [ProductsId] int NOT NULL,
    CONSTRAINT [PK_ProductColors] PRIMARY KEY ([ColorsId], [ProductsId]),
    CONSTRAINT [FK_ProductColors_Colors_ColorsId] FOREIGN KEY ([ColorsId]) REFERENCES [Colors] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_ProductColors_Products_ProductsId] FOREIGN KEY ([ProductsId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE
);
2024-03-27 16:44:54.095 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Comments_ProductId] ON [Comments] ([ProductId]);
2024-03-27 16:44:54.095 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Comments_UserId] ON [Comments] ([UserId]);
2024-03-27 16:44:54.096 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Images_ProductId] ON [Images] ([ProductId]);
2024-03-27 16:44:54.096 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Orders_StatusId] ON [Orders] ([StatusId]);
2024-03-27 16:44:54.097 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Orders_UserId] ON [Orders] ([UserId]);
2024-03-27 16:44:54.098 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_ProductColors_ProductsId] ON [ProductColors] ([ProductsId]);
2024-03-27 16:44:54.098 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Products_BranchId] ON [Products] ([BranchId]);
2024-03-27 16:44:56.549 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Products_CategoryId] ON [Products] ([CategoryId]);
2024-03-27 16:44:56.550 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Products_OrderId] ON [Products] ([OrderId]);
2024-03-27 16:44:56.551 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Products_TagId] ON [Products] ([TagId]);
2024-03-27 16:44:56.551 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_RoleId] ON [Users] ([RoleId]);
2024-03-27 16:44:56.552 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240327094413_InitialCreate', N'8.0.3');
